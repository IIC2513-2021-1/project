const freq = [
  { l: 'a', f: 12.53 },
  { l: 'b', f: 1.42 },
  { l: 'c', f: 4.3 },
  { l: 'd', f: 4.68 },
  { l: 'e', f: 13.68 },
  { l: 'f', f: 1.02 },
  { l: 'g', f: 1.07 },
  { l: 'h', f: 1.0 },
  { l: 'i', f: 4.85 },
  { l: 'j', f: 0.44 },
  { l: 'k', f: 0.02 },
  { l: 'l', f: 5.46 },
  { l: 'm', f: 2.75 },
  { l: 'n', f: 7.26 },
  { l: 'ñ', f: 0.31 },
  { l: 'o', f: 8.68 },
  { l: 'p', f: 2.51 },
  { l: 'q', f: 1.03 },
  { l: 'r', f: 6.87 },
  { l: 's', f: 6.68 },
  { l: 't', f: 4.63 },
  { l: 'u', f: 3.93 },
  { l: 'v', f: 0.77 },
  { l: 'w', f: 0.01 },
  { l: 'x', f: 0.22 },
  { l: 'y', f: 1.01 },
  { l: 'z', f: 0.52 },
];

let text =
  'woymohjñjsñ ñ pñ nñuñ hñohñi fwywi nw tñzsñ zñihñxm ñimnñjnw, fsoswoxm lmj pñ yñppw xw ñp ñjym kgw xñ ñ pñ lpñbñ xw ñjnñi c ñlwoñi pñ pgb xw ywosbñ cmpsfm kgw vpmhñ imzjw wp jsm nw xwrñzñ xsihsougsj pñi vmjnñi, cñ ig ispgwhñ xwpuñxñ iw soiyjszsñ wo wp lgwohw xw pñi ñjhwi, ñ fwywi ñoxñoxm xw go pñxm ñ mhjm, ñ fwywi xwhwosxñ wo wp ljwhsp xw tswjjm, soypsoñxñ imzjw wp ñugñ. c wjñ hño oñhgjñp yjgbñj pñ yñppw, igzsj pmi lwpxñami xwp lgwohw, wohjñj wo ig xwpuñxñ ysohgjñ c ñywjyñjnw ñ pñ nñuñ kgw imojwsñ iso imjljwiñ, ymofwoysxñ ymnm cm xw kgw go woygwohjm yñigñp wjñ pm nwomi yñigñp wo ogwihjñi fsxñi, c kgw pñ uwohw kgw iw xñ yshñi ljwysiñi wi pñ nsinñ kgw owywishñ lñlwp jñcñxm lñjñ wiyjszsjiw m kgw ñljswhñ xwixw ñzñrm wp hgzm xw xwohsvjsym. lwjm wppñ om wihñjsñ ñtmjñ wo wp lgwohw. ig vsoñ yñjñ xw hjñoipgysxñ lswp iw ñimnñjsñ ñ fswrmi lmjhñpwi wo wp utwhhm xwp nñjñsi, kgsbñ wihgfswjñ ytñjpñoxm ymo goñ fwoxwxmjñ xw lñlñi vjshñi m ymnswoxm goñ iñpytsytñ yñpswohw wo wp zmgpwfñjx xw iwzñihmlmp. xw hmxñi nñowjñi igzs tñihñ wp lgwohw, c om wihñzñ ñtmjñ  om wihñzñ wo ns yñnsom, c ñgokgw ymomyíñnmi ogwihjmi xmnsyspsmi, yñxñ tgwym xw ogwihjñi xmi tñzshñysmowi xw vñpimi wihgxsñohwi wo lñjsi, yñxñ hñjrwhñ lmihñp ñzjswoxm goñ fwohñoshñ ymohjñ pñi nmpxgjñi zñjñhñi c pmi lñlwpwi ytsppmowi, ñgo ñis om omi zgiyñjsñnmi wo ogwihjñi yñiñi. ljwvwjsñnmi woymohjñjomi wo wp lgwohw, wo pñ hwjjñbñ xw go yñvw, wo go ysow ypgz m ñuñytñxmi rgohm ñ go uñhm wo ygñpkgswj lñhsm xwp zñjjsm pñhsom. ñoxñzñnmi iso zgiyñjomi lwjm iñzswoxm kgw ñoxñzñnmi lñjñ woymohjñjomi. wo yñxñ ngrwj lñjwysxñ ñ fmi iw ñumplñzñ ymnm go ispwoysm woimjxwywxmj, goñ lñgiñ vspmiñ c yjsihñpsoñ kgw ñyñzñzñ lmj xwjjgnzñjiw hjsihwnwohw, ymnm go lñjñugñi nmrñxm kgw iw yswjjñ. rgihñnwohw go lñjñugñi, nñuñ, hw ñymjxñjsñi kgsbñ xw ñkgwp lñjñugñi fswrm kgw iñyjsvsyñnmi wo go zñjjñoym xwp lñjkgw, go ñhñjxwywj twpñxm xw nñjbm. pm hsjñnmi lmjkgw pm tñzsñi woymohjñxm wo pñ lpñbñ xw pñ ymoymjxsñ, cñ go lmym jmhm, c pm giñihw ngytsisnm, imzjw hmxm lñjñ nwhwjpm wo pñi ymihsppñi xw pñ uwohw wo wp nwhjm c wo pmi ñghmzgiwi, iswnljw hmjlw c xsihjñsxñ c lwoiñoxm wo lñrñjmi lsohmi m wo go xszgrshm kgw tñysño xmi nmiyñi wo wp hwytm xwp ymytw, c ñkgwppñ hñjxw yñcm go ytñlñjjmo c kgsisihw ñzjsj mjugppmiñ hg lñjñugñi ygñoxm wohjñzñnmi wo wplñjkgw, c wo hg nñom iw ñjnm goñ yñhñihjmvw xw jwpñnlñumi vjsmi c ogzwi owujñi, rsjmowi xw hwpñ xwihjmbñxñ yñcwoxm wohjw xwihwppmi xw fñjsppñi xwiwoyñrñxñi, c omi jwsñnmi ymnm pmymi nswohjñi omi wnlñlñzñnmi, lwoiñoxm kgw go lñjñugñi woymohjñxm wo goñ lpñbñ xwzíñ nmjsj xsuoñnwohw wo go lñjkgw, om lmxsñ wohjñj wo wp ysypm soomzpw xwp hñytm xw zñigjñ m xwp ymjxmo xw pñ fwjwxñ; wohmoywi cm pm ñjjmppw pm nwrmj lmiszpw, pm ppwfñnmi tñihñ pm ñphm xwp lñjkgw, ywjyñ xwp lgwohwyshm imzjw wp vwjjmyñjjsp, c xwixw ñpps pm hsjw ymo hmxñi nsi vgwjbñi ñp vmoxm xw pñ zñjjñoyñ xw ywilwx nmrñxm nswohjñi ljmvwjsñi go ujshm xmoxw fñuñnwohw yjws jwymomywj goñ snljwyñysmo xw eñpqcjsñ. wo vso, om wi vñysp tñzpñj xw pñ nñuñ kgw ñ wihñ tmjñ ñoxñ iwugjñnwohw lmj nsjñoxm ñlpsyñxñnwohw wp igwpm tñihñ woymohjñj go lwxñbm xw uwowjm jmrm. is om pm woygwohjñ iwugsjñ ñis hmxñ pñ omytw, jwfmpfwjñ wo pmihñytmi xw zñigjñ, pmi mrmi fsxjsmimi, ymofwoysxñ xw kgw ñpum tmjjszpw pw fñ ñ mygjjsj is om woygwohjñ wiñ ljwoxñ xw jwiyñhw, pñ iwañp xwp lwjxmo m xwp ñlpñbñnswohm. iw pm kgw wi wim lmjkgw hñnzswo mzwxwbym ñ wiñi iwañpwi, hñnzswo tñc fwywi wo kgw nw hmyñ woymohjñj hjñlm jmrm. xwixw pñ sovñoysñ ñlwoñi iw nw yñw ñpum ñp igwpm hwoum kgw pwfñohñjpm, iwñ pm kgw iwñ, lmjkgw is om pm tñum fñ ñ mygjjsj goñ xwiujñysñ, om ñ ns isom ñ ñpugswo ñ kgswo ñnm c ygcm omnzjw wnlswbñ ymo pñ sosysñp xwp mzrwhm yñsxm. pm lwmj wi kgw oñxñ lgwxw ymohwowjnw ygñoxm ñpum iw nw yñw ñp igwpm, os hñnlmym fñpw kgw pm pwfñohw mhjm lmjkgw wp nñpwvsysm mzjñjsñ sugñp. tw lñiñxm ngytñi fwywi lmj pmym ñ yñgiñ xw wihm c pñ fwjxñx wi kgw wihmc pmym ygñoxm pm tñum, ygñoxm nw ljwyslshm ñ rgohñj go pñlsb m go hjmyshm xw lñlwp kgw iw nw tño sxm xw pñ nñom, ymnm pñ omytw xwp hwjjmo xw ñbgyñj wo wp jwihñgjñohw xw pñ yñppw iyjszw, go jwihñgjñohw zñyño ymo nmohmowi xw uwjwohwi, lghñi xw bmjjmi lpñhwñxmi c nñhjsnmosmi zswo mjuñosbñxmi. wihñzñnmi ymo c ñ ns iw nw yñcm go hwjjmo xw ñbgyñj kgw vgw ñ lñjñj ñzñrm xw goñ nwiñ zñihñohw pwrmi xw pñ ogwihjñ. pm ljsnwjm kgw nw ppñnm pñ ñhwoysmo vgw pñ vmjnñ wo kgw wp hwjjmo iw tñzsñ ñpwrñxm, lmjkgw wo uwowjñp pmi hwjjmowi xw ñbgyñj iw lpñohño ñlwoñi hmyño wp igwpm lmj jñbmowi lñjñpwpwlslwxñi wfsxwohwi. lwjm wihw iw ymoxgysñ ymnm is vgwjñ goñ zmpñ xw oñvhñpsoñ, pm ygñp ñgnwohm ns ñljwoismo, c ppwugw ñ yjwwj kgw jwñpnwohw nw pm tñzsño ñjjñoyñxm xw pñ nñom. jmoñpx, kgw nw ymomyw, nsjm tñysñ xmoxw tñzíñ sxm ñ lñjñj wp hwjjmo c iw wnlwbm ñ jwíj. wim nw xsm hmxñfíñ nñi nswxm, nwbypñxm ymo jñzsñ. go nmbm iw ñywjym lwoiñoxm kgw iw nw tñzsñ yñsxm ñpum ljwysmim, goñ lñjqwj m goñ xwohñxgjñ lmihsbñ, c wo jwñpsxñx pm gosym kgw tñysñ wjñ nmpwihñjnw, wohmoywi iso lwxsj lwjnsim nw hsjw ñp igwpm c wnlwyw ñ zgiyñj wp hwjjmo wohjw pmi bñlñhmi xw pñ uwohw kgw wihñzñ ppwoñ xw ygjsmisxñx yjwcwoxm c ymo jñbmo kgw iw hjñhñzñ xw ñpum snlmjhñohw';

let text2 =
  'Xwohjm xwp nmohñyñjuñi pñ pgb wjñ fñuñnwohw ñbgp c iw zñrñzñ ymo go bgnzsxm xw yswoysñ vsyysmo. wo wp imhñom om tñzíñ oñxsw fsfm, lwjm goñ xw pñi lgwjhñi xwp jwvjsuwjñxmj wihñzñ wohmjoñxñ c lmj pñ jñogjñ iñpsñ go ytmjjm xw pgb. Hñpshñ iw lñjm wo pñ lgwjhñ, ymo goñ nñom ymohjñ pñ zmyñ, nswohjñi Mpsfwsjñ iw ñywjyñzñ. Wjñ wp  iw ñymjxñzñ ngc zswo, pñ vñnspsñ hwosñ kgw wihñj ñp yñwj xw go nmnwohm ñ mhjm. Xwixw Hjwpwe. C wohjw hñohm wp tñzsñ jwyszsxm pñ fsishñ xw go ñnsum, wjñ xw snñusoñj pñ ymofwjiñysóo ymo wp fswrm xw pñ lñpmnñ, gom xw wimi iwgxmxsñpmumi wo kgw ñp sohwjpmyghmj pm hswow iso ygsxñxm kgw wp mhjm tñzpw m om tñzpw iswnljw kgw wihw ñts xwpñohw, iswnljw kgw tñcñ ñpum ñtí xwpñohw, ygñpkgswj ymiñ, goñ yñjñ, gomi lswi iñpswoxm xwp tswpm. Ymnm ñyñzñzñ xw tñzpñjpw wp ñ Hñpshñ ymohñoxmpw pm kgw tñzíñ fsihm, ymohñoxmpw kgw hwosñ nswxm, tñzpñoxm hmxm wp hswnlm xw ñugrwjmi c xw lñiñrwi, ñ Hñpshñ m ñ ygñpkgswj mhjm, ñ go lñj xw lswi iñpswoxm xwp tswpm, ñ ygñpkgswj ñlñjswoysñ ñohñumosyñ yñlñb xw wiygytñj c ñiwohsj.';

/* Rúbrica. esta pregunta entrega un total de 20 puntos.

El puntaje va entre paréntesis cuadrados, antes de cada criterio:

- [4 puntos total] Genera una estructura que almacena las letras que aparecen en el texto encriptado y 
     calcula bien las frecuencias de dichas letras. Convierte el texto a minusculas.
     Se descuenta la mitad del puntaje si se colocan y contabilizan en el arreglo los signos de puntuacion que se debian excluir. 
     Se descuenta 1 punto si no se convierte el texto a minúsculas.

- [8 puntos total] Se entrega un algoritmo que permte "adivinar" la letra correcta en función de las frecuencias
     entregadas en freq versus las frecuencias calculadas en el punto anterior (4 puntos). 
     El algoritmo tambien toma en cuenta los "empates" y desempata (2 puntos). 
     Además se progama de tal forma que no hayan letras repetidas en lo "adivinado" (2 puntos)

- [2 puntos total] Se realiza la sustitución de las letras "adivinadas" en el texto encriptado y se entrega una "desencriptación"
     en base a las letras "adivinadas"

- [6 puntos total] El texto es legible, contiene algunas imprecisiones pero se puede leer y entender.
     Si el texto no es facilmente legible y requiere esfuerzo para entenderlo se decuenta la mitad del puntaje.
     Si el texto no es legible en lo absooluto, se descuenta todo el puntaje de esta parte.
*/

/* Se determina si el parámetro entregado es "letra" válida (se excluyen espacios, y los caracteres de puntuacion señalados en el enunciado)
 */

function isLetter(char) {
  if (char == ' ' || char == '.' || char == ',' || char == ';') return false;
  return true;
}

/* Algoritmo que asigna una letra "real" a una encriptada dado el cálculo de distancia entre las frecuencias dadas
por la tabla freq y las frecuencias "encontradas" en el texto encriptado.
*/

function guessTheLetter(freqTable, freqLetter, excluded) {
  let minDistance = 1000000;
  myGuess = [];
  freqTable.forEach((element) => {
    distance = Math.abs(element.f - freqLetter);

    if (distance < minDistance && excluded.indexOf(element.l) == -1) {
      minDistance = distance;
      myGuess = element.l;
    }
  });

  return myGuess;
}

/* Se calcula la frecuencia (proporcion) de las letras encontradas en el texto encriptafo*/

function calFreq(arrayWords) {
  let frequency = 0;
  let arrayFq = [];
  let total = arrayWords[2];

  arrayWords[0].forEach((element) => {
    frequency = Math.round((element / total) * 10000) / 100;
    arrayFq.push(frequency);
  });

  return arrayFq;
}

/* Recorre el arreglo de letras encriptadas y va generando un arreglo" aumulativo que entrega el numero de veces de la letra
en el texto y calcula la cantidad total de letras en el texto, usado todo lo anterior para calcula la frecuencia de las letras encriptadas
*/

function wordCount(text, arrTxt) {
  let totLetters = 0;
  let arrayReturned = [];
  let arrayLetters = [];
  let arrayCount = [];

  arrTxt.forEach((element) => {
    if (isLetter(element)) {
      totLetters = totLetters + 1;
      index = arrayLetters.indexOf(element);
      if (index > -1) {
        arrayCount[index] = arrayCount[index] + 1;
      } else {
        arrayCount.push(1);
        arrayLetters.push(element);
      }
    }
  });

  arrayReturned[0] = arrayCount;
  arrayReturned[1] = arrayLetters;
  arrayReturned[2] = totLetters;

  return arrayReturned;
}

/* Basado en la asignacion "adivinada" o calculada de letras, se procede a reemplazar cada letra del texto encriptado 
por la letra "real-adivinada" y se genera el texto "traducido"
*/

function translateText(arrGuess, arrLetters, arrTxt) {
  let guessedText = [];

  arrTxt.forEach((element) => {
    if (isLetter(element)) {
      index = arrLetters.indexOf(element);
      reemplazo = arrGuess[index];
      guessedText.push(reemplazo);
    } else guessedText.push(element);
  });

  let guessedTextString = '';
  guessedText.forEach((element) => {
    guessedTextString = guessedTextString + element;
  });

  return guessedTextString;
}

/* funcion principal que desencripta el texto entregado*/

function decryptText(text, freq) {
  /* Write your solution here */
  let arrayGuess = [];
  let arrWords = [];
  let arrayFreq = [];

  text = text.toLowerCase();
  let arrayText = [...text];

  arrWords = wordCount(text, arrayText);
  arrayFreq = calFreq(arrWords);

  arrayFreq.forEach((element) => {
    theGuess = guessTheLetter(freq, element, arrayGuess);
    arrayGuess.push(theGuess);
  });

  return translateText(arrayGuess, arrWords[1], arrayText);
}

console.log(decryptText(text, freq));

console.log(
  '\n-------- Texto de control extraído tambien desde Rayuela --------\n'
);

/* Si se ejecuta derypt con el text2, se verá como una muestra pequeña puede generar
   traducciones ilegibles dada la poca cantidad de letras que permita dar una frecuencia adecuada.
*/

console.log(decryptText(text2, freq));

module.exports = {
  decryptText,
};
